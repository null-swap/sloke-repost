package cc.sleek.client.module.impl.exploit;

import cc.sleek.client.event.impl.PacketEvent;
import cc.sleek.client.module.Module;
import cc.sleek.client.module.api.Category;
import cc.sleek.client.module.api.ModuleInfo;
import cc.sleek.client.util.ChatUtil;
import cc.sleek.client.util.Stopwatch;
import io.github.nevalackin.homoBus.Listener;
import io.github.nevalackin.homoBus.annotations.EventLink;
import net.minecraft.network.play.client.C0FPacketConfirmTransaction;
import net.minecraft.util.EnumChatFormatting;

import java.util.concurrent.TimeUnit;

@ModuleInfo(name = "Transactions", description = "Counts transactions you sent in 10 seconds", category = Category.EXPLOIT)
public class Transactions extends Module {

    private int count = 0;
    private final Stopwatch stopwatch = new Stopwatch();

    @EventLink
    Listener<PacketEvent> packetEventListener;

    public Transactions() {
        packetEventListener = packetEvent -> {
            if (packetEvent.getPacket() instanceof C0FPacketConfirmTransaction) {
                count++;
            }
            if (stopwatch.timeElapsed(TimeUnit.SECONDS.toMillis(10L))) {
                toggle();
            }
        };
    }

    @Override
    public void onEnable() {
        stopwatch.resetTime();
        count = 0;
    }

    @Override
    public void onDisable() {
        ChatUtil.log("Sent", EnumChatFormatting.GOLD.toString(), count, EnumChatFormatting.RESET, "transactions in the last 10 seconds");
    }
}
